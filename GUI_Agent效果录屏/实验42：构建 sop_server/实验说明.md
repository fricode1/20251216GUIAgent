# 实验背景

我应该增加一个 tool。

实现语言：python

功能：用户输入：犯人昨天下午跑了，怎么办？

prompt：根据用户输入和系统使用说明书(reference.txt)，生成web系统逐步骤的操作指南。不要有分支情况，不要假设有任何其他多余内容（比如，如果用户开车，就如何如何）。

# 实验目的

完成 sop_server.py 根据用户输入和reference.txt，调用大模型生成web系统逐步骤的操作指南。不要有分支情况，不要假设有任何其他多余内容（比如，如果用户开车，就如何如何）。

# 实验步骤

## 准备好大模型调用方式

api_key = 'sk-efe1c9004f7e4de0a8ade26120301c6d'
base_url = 'https://dashscope.aliyuncs.com/compatible-mode/v1'
model = 'qwen-vl-max'

## 让gemini为我写代码

### 第一版

```python
system_prompt = (
        "你是一个专业的Web系统操作手册撰写专家。"
        "你的任务是根据提供的参考资料（reference），为用户生成一个确定性的、逐步骤的操作指南。"
        "【严格遵守以下规则】：\n"
        "1. 必须是线性的步骤（第一步、第二步...），严禁出现任何分支情况（例如：禁止使用“如果...则...”、“若遇到...请...”）。\n"
        "2. 不要假设任何多余的内容或外部场景（例如：禁止提及“如果您在开车”、“如果您在户外”等）。\n"
        "3. 只提供完成目标所需的直接路径。\n"
        "4. 语言必须简洁、专业，直接描述点击或输入动作。"
    )

    user_prompt = f"""
参考资料：
---
{reference_text}
---

用户需求：
{user_input}

请根据参考资料生成该任务的步骤指南：
"""
```

```text
根据参考资料，以下是针对“有个犯人昨天下越狱了”这一任务的步骤指南。该指南将结合InfovisionPVIA视频图像综合应用平台的功能，指导用户如何利用系统进行追踪和布控。

---

### **任务：追踪越狱犯人**

#### **目标**
1.  确定越狱犯人的身份信息（如姓名、身份证号、照片）。
2.  在全城范围内进行布控，实时监控其行踪。
3.  分析其可能的逃跑路线和藏身之处。
4.  快速响应并上报任何发现。

---

### **步骤指南**

#### **第一步：获取犯人身份信息**
在执行任何搜索或布控前，必须先确认犯人的身份信息。这通常需要从公安内部系统中获取。

*   **操作**：
    1.  登录 `InfovisionPVIA` 平台。
    2.  进入 **智能名单库** 模块。
    3.  在 **人员名单库—名单管理** 中，通过“姓名”、“身份证号”或“人员标签”（如“在逃人员”、“重点人员”）等条件，查找该越狱犯人的档案。
    4.  找到后，点击进入 **人员档案** 详情页，确认其姓名、身份证号、照片等关键信息。

#### **第二步：创建个体布控任务**
使用获取到的身份信息，在平台上创建一个高优先级的布控任务，以便系统能自动识别并报警。

*   **操作**：
    1.  进入 **多维预警** 模块。
    2.  选择 **个体布控** -> **人脸布控**。
    3.  **布控目标**：上传该犯人的正面免冠照（至少一张），确保图片清晰。
    4.  **任务要素**：
        *   **布控有效期**：选择“永久”或“自定义”，设置为长期有效。
        *   **布控地点**：选择“地图选点”或“目录选点”，勾选整个城市范围内的所有监控点位。
        *   **布控有效时段**：选择“全天候”。
        *   **最小预警相似度**：设置为80%或更高，以减少误报。
        *   **预警推送范围**：选择所有相关警员的账号。
        *   **关注级别**：选择“严重关注”。
        *   **处置类型**：选择“抓捕类”。
        *   **布控原因**：填写“越狱犯人，紧急布控”。
    5.  填写完所有信息后，点击“提交”按钮，创建布控任务。

#### **第三步：启动智能战法分析**
利用平台的高级分析功能，预测犯人的行为模式，扩大搜寻范围。

*   **操作**：
    1.  进入 **智能战法** 模块。
    2.  选择 **人脸技战法** -> **人员消失**。
    3.  **分析条件**：
        *   **分析对象**：输入该犯人的姓名或身份证号。
        *   **消失天数**：设置为“1天”。
        *   **分析时间范围**：选择“昨天”。
        *   **分析区域**：选择整个城市范围。
    4.  点击“分析”按钮。
    5.  **结果分析**：系统会返回在指定区域内，该犯人“从未出现”的区域列表。这些区域是其可能藏匿的地点，应作为重点排查区域。

#### **第四步：进行轨迹分析与搜索**
如果已知犯人越狱的具体时间和地点，可以进行更精确的轨迹分析。

*   **操作**：
    1.  进入 **智能搜索** 模块。
    2.  选择 **智图研判** -> **图片搜索**。
    3.  **上传图片**：上传该犯人的照片。
    4.  **查询条件**：
        *   **查询范围**：选择“地图选点”，框选越狱监狱周边区域。
        *   **时间范围**：选择“昨天”。
    5.  点击“查询”按钮。
    6.  **结果分析**：查看搜索结果，找到其越狱后的首次抓拍记录。然后，点击“加入轨迹”按钮，开始描绘其逃跑路线。

#### **第五步：实时监控与响应**
布控和分析任务创建后，系统将自动运行。用户需要持续监控告警。

*   **操作**：
    1.  定期查看 **事件报警** 模块中的 **实时事件** 页面。
    2.  当系统检测到与该犯人相似的人脸时，会生成一条新的告警。
    3.  **处理告警**：
        *   点击告警条目，进入 **事件详情** 页面。
        *   查看告警图片和抓拍位置。
        *   如果确认是该犯人，立即点击“处置”按钮，并通知现场警力前往抓捕。
        *   如果是误报，点击“核验”按钮，选择“误报”并填写备注。

#### **第六步：上报战果**
成功抓捕后，需要将案件信息上报。

*   **操作**：
    1.  进入 **战果上报** 模块。
    2.  点击“战果上传”。
    3.  填写相关信息，如“案件名称”、“案件主侦人”、“涉案人数”等。
    4.  在富文本编辑器中，详细描述抓捕过程，并上传现场照片。
    5.  点击“提交”按钮，完成战果上报。

---

### **总结**
本指南通过以下核心功能完成了对越狱犯人的追踪任务：
1.  **智能名单库** 和 **人员档案**：用于获取和确认目标身份。
2.  **多维预警** 的 **个体布控**：实现全城范围的实时监控和自动报警。
3.  **智能战法** 的 **人员消失**：预测其可能的藏匿地点。
4.  **智能搜索** 的 **图片搜索**：追溯其逃跑路线。
5.  **事件报警**：接收和处理系统告警。
6.  **战果上报**：记录和分享最终成果。

通过以上步骤，可以高效地利用InfovisionPVIA平台的强大功能，快速定位并抓捕越狱犯人。
```

我的问题是：有个犯人昨天下午越狱了。这个回答的不足之处：
1. 成功抓捕后，如何如何。不足之处：我需要的是操作平台抓获犯人。操作平台后，就要等待执行结果了。你生成的动作序列应该是一下就能完成的，根本不应该提成功抓捕后如何如何。因为这还不知道要多长时间。所以，操作动作应该包括马上能做的，而不是将来要做的。

2. 定期查看 **事件报警** 模块中的 **实时事件** 页面。这属于给用户的建议。不属于操作序列。

3. 生成的内容不符合 1. 点击xxx 2. 填写xxx 3. 进入 xxx 这种格式

4. 选择“地图选点”或“目录选点”：操作中不能有或然情况。否则你让自动化流程选择哪部去操作呢？

### 第二版

=== 严格指令 SOP 生成器 ===
请输入任务描述：有个犯人昨天下午越狱了

正在生成线性操作步骤...

------------------------------
1. 点击页面右上角的“系统管理”按钮。
2. 在下拉菜单中选择“应用配置管理”。
3. 在应用配置管理页面中，点击“智能战法管理中心”。
4. 在智能战法管理中心页面中，点击“技战法配置”。
5. 展开“人像技战法配置”，找到“人员消失”选项。
6. 点击“人员消失”选项，进入配置页面。
7. 在“基本信息”区域，设置“有效期”为“永久模板”。
8. 设置“关注级别”为“严重关注”。
9. 设置“布控原因”为“越狱犯人”。
10. 在“预警对象”区域，选择“名单库”并选择包含该犯人的名单库。
11. 设置“人脸相似度”为“80%”。
12. 在“智能策略”区域，设置“消失天数”为“1”。
13. 在“预警范围”区域，选择“目录选点”并选择监狱周边的监控点位。
14. 在“预警推送范围”区域，选择需要接收预警信息的用户或用户组。
15. 点击“保存”按钮，完成配置。
16. 返回到首页，点击“多维预警”模块。
17. 在多维预警模块中，点击“个体布控”。
18. 上传该犯人的照片作为布控目标。
19. 设置布控有效期为“永久”。
20. 设置布控地点为监狱周边的监控点位。
21. 设置最小预警相似度为“80%”。
22. 设置预警推送范围为需要接收预警信息的用户或用户组。
23. 点击“提交”按钮，创建布控任务。
------------------------------

# 实验结果

初步验证了可行性