# 实验背景

我要在内网windows11电脑上用python实现playwright脚本。如果每次执行时弹出新浏览器窗口，则每次都需要重新登录。怎么办。

# 实验目的

解决每次运行脚本是需要登录的问题

# 实验步骤

## 将 chrome 在指定端口启动

```powershell
taskkill /f /im chrome.exe
"C:\Program Files\Google\Chrome\Application\chrome.exe" --remote-debugging-port=9222 --user-data-dir="C:\chrome_dev_profile"
netstat -ano | findstr :9222
```
显示如下内容，说明启动成功：

```
TCP    127.0.0.1:9222         0.0.0.0:0              LISTENING       32860
```

但是依旧无法共享登录信息

通过如下方式解决：

```python
from playwright.sync_api import sync_playwright

with sync_playwright() as p:
    browser = p.chromium.connect_over_cdp("http://localhost:9222")
            
    # 获取现有的上下文 (Context)
    context = browser.contexts[0]

    # 获取所有已打开的标签页
    pages = context.pages
    if len(pages) > 0:
        page = pages[0]
        print(f"正在接管现有页面: {page.title()}")
    else:
        page = context.new_page()

    # 直接操作，此时是登录状态
    page.goto("https://www.taobao.com") 
    print(page.content())
```

但是 `page.content()` 无法获取DOM内容。
- 知乎：可以获取。
- 淘宝：可以获取。
- https://www.w3schools.com/tags/tryit.asp?filename=tryhtml_iframe 不行
- https://aistudio.google.com/prompts/14d7BxjbcL2d9aIa6w94t0k4gMc9r1SWy?pli=1 可以

Gemini 的解释：iframe的内容不会出现在左侧主页面的 page.content() 里

## 使用 cdp

成功。注意不能在控制台中搜索，因为太长，控制台不完整。

# 实验结果

成功连接现有页面/。成功捕获iframe内容