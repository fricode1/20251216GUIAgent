# 实验背景

寻找了一整天的容器浏览器终于找到了（实验80），现在要用起来

# 实验目的

制作容器浏览器

# 实验步骤

## 拷贝代码

成功。

## 问大模型如何制作镜像

我通过 docker-compose.yml 运行的容器很好，但是该容器缺少了 requirements.txt 中的pip包，以及 node 环境。我该怎么办？

## 将核心代码复制过来

cd frontend
npm install

## 构建镜像

docker build --pull=false -t auto-web:v2.0 .

## 难点：好像Alpine不支持onnxruntime

lscr.io/linuxserver/webtop 能够在容器中使用浏览器。但是Alpine不支持onnxruntime

## 【成功】使用新的基础镜像

lscr.io/linuxserver/webtop:ubuntu-xfce

进入内部验证是否能用 DrissionPage

sudo docker run -it lscr.io/linuxserver/webtop:ubuntu-xfce /bin/bash

不行。

换成 docker-compose.yml 启动

成功。经验：必须从yml启动。

## 构建镜像

sudo docker build --pull=false -t auto-web:v2.0 .

## 【成功】运行 yml

sudo docker compose up

http://localhost:3000/ 看实时界面

sudo docker ps 看 container id

sudo docker exec -it a7c /bin/bash

测试DrissionPage

```python
from DrissionPage import Chromium
tab = Chromium().latest_tab
tab.get('https://www.baidu.com')
```

清理容器

sudo docker stop $(sudo docker ps -aq)
sudo docker rm $(sudo docker ps -aq)

## 运行代码

### 运行 minio

./minio server /minio-data --console-address ":9001"

### 运行后端

python backend/main.py

### 运行前端

cd frontend
npm run dev -- --host

在宿主机中访问 localhost:3002 输入 工业路与新华路今天的违章

前端显示：

正在查询“xxx”的违章记录...
正在查询中...(不停旋转的圈圈)

## 打包镜像

sudo docker save -o /tmp/auto-web:v2.0.tar auto-web:v2.0

## 查看内网运行效果

### 【成功】屏幕分辨率问题

在 docker-compose.yml 中设置参数：--window-size=1920,1080

成功。已经验证了能够解决点击登录按钮的问题

### 【成功】隐私问题

在 docker-compose.yml 中设置参数：--ignore-certificate-errors

### 【成功】在容器中运行前端使得宿主机能够访问

在 docker-compose.yml 中设置参数：
ports:
    - "3002:3002"
npm run dev -- --host

### minio图片加载失败

在 docker-compose.yml 中设置参数：
ports:
    - "9000:9000"
    - "9001:9001"

成功

（发现前端bug：显示内容时，会重复。）