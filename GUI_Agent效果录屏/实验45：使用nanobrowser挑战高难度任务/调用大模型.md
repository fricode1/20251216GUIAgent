```mermaid
sequenceDiagram
    autonumber
    participant Main as index.ts (Main)
    participant Exec as executor.ts (Executor)
    participant Planner as planner.ts (PlannerAgent)
    participant Base as base.ts (BaseAgent)
    participant LLM as LLM (External SDK)

    Main->>Exec: setupExecutor()
    Main->>Exec: execute()
    
    activate Exec
    loop Step < allowedMaxSteps
        Exec->>Exec: runPlanner()
        
        activate Exec
        Exec->>Planner: execute()
        
        activate Planner
        Planner->>Base: invoke(plannerMessages)
        
        activate Base
        Base->>LLM: withStructuredOutput()
        LLM-->>Base: structuredLlm instance
        
        Base->>LLM: invoke()
        Note over LLM: 无法进一步 Step Into<br/>(网络请求/外部推理)
        LLM-->>Base: response
        
        Base-->>Planner: response.parsed
        deactivate Base
        
        Planner-->>Exec: planOutput
        deactivate Planner
        
        deactivate Exec
        Note right of Exec: 根据 planOutput <br/>进行下一步动作
    end
    
    Exec-->>Main: result
    deactivate Exec
```

```typescript
index.ts
    currentExecutor = setupExecutor()
    result = currentExecutor.execute()  // 调用 executor.ts/Executor/execute()

executor.ts
    class Executor
        execute()
            for (step = 0; step < allowedMaxSteps; step++)
                latestPlanOutput = this.runPlanner()  // 调用 executor.ts/Executor/runPlanner()

executor.ts
    class Executor
        runPlanner()
            planOutput = this.planner.execute()  // 调用 planner.ts/PlannerAgent/execute()

planner.ts
    class PlannerAgent
        execute()
            modelOutput = this.invoke(plannerMessages)  // 调用 base.ts/BaseAgent/invoke()

base.ts
    class BaseAgent
        invoke()
            structuredLlm = this.chatLLM.withStructuredOutput()
            response = structuredLlm.invoke()  // 无法继续 step into
            return response.parsed
```