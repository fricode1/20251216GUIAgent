# 实验背景

通过多种方法多次实验，得出矛盾结果。现在需要在clear_text代码中逐步注释掉js代码，找出哪里出了问题

# 实验目标

在clear_text代码中逐步注释掉js代码，看什么时候焦点能正常

# 实验步骤

## 明确打印焦点的代码

```python
result = await cdp_session.cdp_client.send.Runtime.evaluate({
    "expression": """
        (function() {
            const focused = document.activeElement;
            if (!focused) return null;
            // 返回焦点元素的标签名、ID 和类名
            return {
                tagName: focused.tagName,
                id: focused.id,
                className: focused.className,
                outerHTML: focused.outerHTML.substring(0, 100)  // 截取部分 HTML
            };
        })()
    """,
    "returnByValue": True
}, session_id=cdp_session.session_id)

if result["result"]["value"]:
    focused_info = result["result"]["value"]
    print("当前焦点元素信息：")
    print(f"标签名: {focused_info['tagName']}")
    print(f"ID: {focused_info['id']}")
    print(f"类名: {focused_info['className']}")
    print(f"HTML 片段: {focused_info['outerHTML']}")
else:
    print("当前无焦点元素")
```

## 明确 clear_text 代码位置

完成

## 逐步注释

```JavaScript
// this.dispatchEvent(new Event("change", { bubbles: true }));
```

出现焦点

恢复原来代码

焦点消失

# 实验结论

```JavaScript
// this.dispatchEvent(new Event("change", { bubbles: true }));
```

这一句导致了焦点消失。以前的矛盾能解释通了。为什么出现矛盾结果？当你把核心代码摘出来时，其实对应的是出现正确结果的代码。现在的问题成了：为什么没有点击一下文本框，直接执行clear_text（其中有change代码）不会失去焦点，但是点击了文本框，再执行clear_text（其中有change代码）失去焦点，而点击了文本框，再执行clear_text(其中没有change代码)不会失去焦点？

我需要在浏览器模拟如下两种状态：
1. 获取文本框元素 - 点击文本框 - 获取焦点 - 查看焦点（应该不在文本框） - 清空文本 - change - 查看焦点（应该不在文本框）
2. 获取文本框元素 - 查看焦点（应该不在文本框） - 清空文本 - change - 查看焦点（应该在文本框）