# 实验背景

违章行人身份确认流程自动化系统已经开发完毕，我需要将后端部署到容器。

# 实验目的

将后端代码部署到容器

# 实验步骤

## 准备代码

明确要把哪些代码部署到容器。

就两个文件：main.py, spider.py

我要把这两个文件拷贝过来。main.py 已经修改了minio的配置。spider.py已经修改了文件删除逻辑。

## 准备镜像

在实验81中研究了浏览器镜像。

实验81的要点：
- 必须用docker-compose.yml启动容器，才能正确启动浏览器环境。
- docker-compose.yml 要调用一个镜像，这个镜像是我用 Dockerfile 创建的。
- 我现在要重做镜像，因为代码变了。
- 构建镜像的方法：docker build --pull=false -t auto-web:v2.0 .

## 明确 docker-compose.yml

我希望容器一启动就能自动执行 main.py, 且端口号配置正确，让前端、后端、minio能够顺利互通。同时保证原本的浏览器环境的正常使用。

1. 在 command 中加上了启动 main.py 的代码
2. 在端口映射中配置了8000端口

## 打包镜像

docker save -o ../auto-web_v2.0.tar auto-web:v2.0
（windows系统中tar文件名不能带冒号）

## 内网运行

docker load -i auto-web_v2.0.tar

导入镜像。导入成功后，可通过 docker images 命令确认 auto-web:v2.0 镜像已存在于本地仓库。

确保以下文件已放置在宿主机的同一工作目录下：
docker-compose.yml
nginx.conf（需与 docker-compose.yml 中 volumes 指定的路径一致）

在配置文件所在目录执行以下命令以启动服务：
docker-compose up -d
该命令将依据配置启动容器

前端成功访问容器中的后端代码。