# 实验背景

感觉视综平台和MRAG平台能用的功能真少啊。

好不容易发现一个：将MRAG平台布控的渣土车，送入视综平台查询车主。

然而，这涉及到图像在不同平台流转的问题。

能不能解决？

# 实验目的

探索图像在不同平台流转的问题

# 实验步骤

## 问题拆分

拆分为两步：图像保存和上传。

## 图像保存

能否保存图像？

问大模型：我有一个浏览器插件，
- 该插件能够获取调试浏览器的权限，能够打开/操作任意标签页
- 能够通过DOM读取/操作网页内容。
2. 能够将读取到的网页文本保存到插件的本地存储系统。

网页上有一张图片，能否像保存文本一样，将图片也保存下来？

### 难点

nanobrowser 无法将图像视作可交互元素

试试 browseros：似乎同样未能将图像视作可交互元素

### 突破

我从F12可知，能够获得图像URL。
- 百度图片可以获得
- 哔哩哔哩视频封面图像可以获得

注意，互联网平台和内网系统还不一样。

但是初步理顺可可行性：根据DOM中的图像链接，将图像保存成BASE64。

## 图像上传

ctrl v 确实在一些网站上有用

具有debugger权限的浏览器插件，能够读写电脑的剪贴板吗？

在 manifest.json 中配合申请 clipboardRead 和 clipboardWrite 权限

我突然想到，在clash上是能够将配置链接复制剪贴板的。所以我对插件肯定可以操作剪贴板。

下面的问题是，视综平台，支持剪贴板传递图像吗？试一试就知道了。

试过了。视综平台虽然不支持剪贴板，但是支持填写URL。这是一个重大突破。

不过，MRAG的图像的链接是 data:image...(后接一长串base64)，但是填写到视综平台上，显示这是不支持的URL格式。

### URL.createObjectURL

好像视综平台可以接受这种格式： `blob:http://视综平台IP/...。

具体如何使用？

```typescript
const response = await fetch(imageUrl)
const blob = await response.blob()
const objectURL = URL.createObjectURL(blob)
```

我要用这个方法，试试视综平台能否接受这样生成的URL

可行。但是视综平台有bug。对于BLOB的URL，能加载上图片，但是无法进一步理解。

难道必须是纯种URL？有例子可以试试吗？

可以。用 纯 URL 成功。

也就是说，需要一个文件中转功能。

我将来还要做 rag，也是需要后端的。

将来还要做后台管理，依旧需要后端。

如果我想记录操作轨迹，还是需要后端。

## 在内网操作后端开发环境

有。能用python，和 fastapi

## 开发后端

完成

## 新的情况

视综平台好像没有上传车辆图片识别车牌的功能。有上传车辆图片的功能，但是识别不出来。

发现可以从MRAG平台找出人群聚集图像，发送至视综平台能够找到人脸图像。

但是 url 是未受信任的。所以通过后端URL上传图像似乎行不通了。

## 尝试绕过本地上传步骤

我写了一个浏览器插件，具有 debugger 权限，能读取/操纵浏览器的任何 tab。
有一个网页有文件上传功能。可是我不想手动点击从本地上传，该文件在插件内部的存储里。我该怎么办?

```javascript
// 你的 Base64 数据
const base64Data = "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==";
const fileName = "image.png";
const mimeType = "image/png";

// 将 Base64 转为 Blob
fetch(`data:${mimeType};base64,${base64Data}`)
  .then(res => res.blob())
  .then(blob => {
    const file = new File([blob], fileName, { type: mimeType });
    const dataTransfer = new DataTransfer();
    dataTransfer.items.add(file);
    
    const fileInput = document.querySelector('input[type="file"]');
    fileInput.files = dataTransfer.files;
    fileInput.dispatchEvent(new Event('change', { bubbles: true }));
    console.log("图片已注入");
  });
  ```

  上述代码成功了

  但是视综平台不行

  ## 请教港一场景

  在视综平台（摄像头播放功能完备），发现某时某地有需要重点关注的某特征的人。则需要在mrag平台周边摄像头进行搜索。

# 实验结果

这个功能比较棘手。ROI太低。