# å®éªŒèƒŒæ™¯

å·²ç»å½•åˆ¶äº†4ä¸ªæ¡ˆä¾‹ã€‚å†å½•æœ€åä¸€ä¸ªã€‚å¸Œæœ›èƒ½æé«˜éš¾åº¦ï¼Œä»è€Œè¯æ˜å¯ç”¨æ€§ã€‚

# å®éªŒç›®çš„

é€šè¿‡è¯¦ç»†æç¤ºè¯ï¼Œå®Œæˆ12306è´­ç¥¨åŠŸèƒ½ã€‚

# prompt å†…å®¹

"""
1. è¿›å…¥ https://www.12306.cn/index/
2. ç‚¹å‡» å‡ºå‘åœ° æ–‡æœ¬æ¡†ï¼Œè¾“å…¥ åŒ—äº¬åŒ—
3. åœ¨ä¸‹æ‹‰åˆ—è¡¨ä¸­ï¼Œç‚¹å‡» åŒ—äº¬åŒ—
4. ç‚¹å‡» åˆ°è¾¾åœ° æ–‡æœ¬æ¡†ï¼Œè¾“å…¥ æ€€æŸ”åŒ—
5. åœ¨ä¸‹æ‹‰åˆ—è¡¨ä¸­ï¼Œç‚¹å‡» æ€€æŸ”åŒ—
6. ç‚¹å‡» å‡ºå‘æ—¥æœŸ åˆ—è¡¨ï¼Œè¾“å…¥ 2025-12-31
7. ç‚¹å‡»æŸ¥è¯¢æŒ‰é’®
8. ç‚¹å‡» S511 è½¦æ¬¡çš„é¢„å®šæŒ‰é’®
9. ç‚¹å‡»æäº¤è®¢å•æŒ‰é’®
"""

# å®éªŒç»“æœ

(browser_use_py312) zhbli@zhbli-91C6A09QKX:~/projects/20251216GUIAgent/code/browser_use_example$ python 
auto_login.py      my_browser_use.py
(browser_use_py312) zhbli@zhbli-91C6A09QKX:~/projects/20251216GUIAgent/code/browser_use_example$ python 
auto_login.py      my_browser_use.py
(browser_use_py312) zhbli@zhbli-91C6A09QKX:~/projects/20251216GUIAgent/code/browser_use_example$ python my_browser_use.py 
INFO     [utils] Copied profile (Default) and Local State to temp directory: /tmp/browser-use-user-data-dir-be813cda
INFO     [service] Using anonymized telemetry, see https://docs.browser-use.com/development/telemetry.
INFO     [Agent] ğŸ”— Found URL in task: https://www.12306.cn/index/, adding as initial action...
INFO     [Agent] ğŸ¯ Task: 
        1. è¿›å…¥ https://www.12306.cn/index/
        2. ç‚¹å‡» å‡ºå‘åœ° æ–‡æœ¬æ¡†ï¼Œè¾“å…¥ åŒ—äº¬åŒ—
        3. åœ¨ä¸‹æ‹‰åˆ—è¡¨ä¸­ï¼Œç‚¹å‡» åŒ—äº¬åŒ—
        4. ç‚¹å‡» åˆ°è¾¾åœ° æ–‡æœ¬æ¡†ï¼Œè¾“å…¥ æ€€æŸ”åŒ—
        5. åœ¨ä¸‹æ‹‰åˆ—è¡¨ä¸­ï¼Œç‚¹å‡» æ€€æŸ”åŒ—
        6. ç‚¹å‡» å‡ºå‘æ—¥æœŸ åˆ—è¡¨ï¼Œè¾“å…¥ 2025-12-31
        7. ç‚¹å‡»æŸ¥è¯¢æŒ‰é’®
        8. ç‚¹å‡» S511 è½¦æ¬¡çš„é¢„å®šæŒ‰é’®
        9. ç‚¹å‡»æäº¤è®¢å•æŒ‰é’®
        
INFO     [Agent] Starting a browser-use agent with version 0.11.2, with provider=openai and model=qwen-vl-max
INFO     [Agent]   â–¶ï¸   navigate: url: https://www.12306.cn/index/, new_tab: False
INFO     [tools] ğŸ”— Navigated to https://www.12306.cn/index/
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 1:
INFO     [Agent]   ğŸ‘ Eval: The initial URL has been successfully loaded and the page is now visible.
INFO     [Agent]   ğŸ§  Memory: The browser has navigated to the 12306 homepage. The next step is to interact with the departure station input field.
INFO     [Agent]   ğŸ¯ Next goal: Click on the 'å‡ºå‘åœ°' (Departure Station) text box to prepare for input.
INFO     [Agent]   â–¶ï¸   navigate: url: https://www.12306.cn/index/, new_tab: False
INFO     [tools] ğŸ”— Navigated to https://www.12306.cn/index/
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 2:
INFO     [Agent]   ğŸ‘ Eval: Successfully navigated to the 12306 homepage and identified the departure station input field. Verdict: Success
INFO     [Agent]   ğŸ§  Memory: The page has loaded successfully, and the departure station input field (index 3423) is visible and ready for interaction. The next step is to click on it and input 'åŒ—äº¬åŒ—'.
INFO     [Agent]   ğŸ¯ Next goal: Click on the 'å‡ºå‘åœ°' (Departure Station) text box and input 'åŒ—äº¬åŒ—'.
INFO     [Agent]   â–¶ï¸  [1/2] click: index: 3423
INFO     [tools] ğŸ–±ï¸ Clicked input type=text id=fromStationText aria-label=è¯·è¾“å…¥æˆ–é€‰æ‹©å‡ºå‘åœ°ï¼ŒæŒ‰é”®ç›˜ä¸Šä¸‹é”®è¿›è¡Œé€‰æ‹©
INFO     [Agent]   â–¶ï¸  [2/2] input: index: 3423, text: åŒ—äº¬åŒ—, clear: True
INFO     [BrowserSession] âŒ¨ï¸ Typed "åŒ—äº¬åŒ—" into element with index 3423
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 3:
INFO     [Agent]   ğŸ‘ Eval: Successfully clicked on the departure station input field and typed 'åŒ—äº¬åŒ—'. Verdict: Success
INFO     [Agent]   ğŸ§  Memory: The departure station input field has been successfully filled with 'åŒ—äº¬åŒ—'. The dropdown list now shows 'åŒ—äº¬åŒ—' as an option. Next step is to select it from the dropdown.
INFO     [Agent]   ğŸ¯ Next goal: Click on the 'åŒ—äº¬åŒ—' option in the dropdown list to confirm the selection.
INFO     [Agent]   â–¶ï¸   click: index: 6944
INFO     [tools] ğŸ–±ï¸ Clicked span "åŒ—äº¬åŒ—"
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 4:
INFO     [Agent]   ğŸ‘ Eval: Successfully selected 'åŒ—äº¬åŒ—' from the dropdown list. Verdict: Success
INFO     [Agent]   ğŸ§  Memory: The departure station 'åŒ—äº¬åŒ—' has been successfully set. The next step is to input 'æ€€æŸ”åŒ—' into the arrival station field.
INFO     [Agent]   ğŸ¯ Next goal: Click on the 'åˆ°è¾¾åœ°' (Arrival Station) text box and input 'æ€€æŸ”åŒ—'.
INFO     [Agent]   â–¶ï¸  [1/2] click: index: 3424
INFO     [tools] ğŸ–±ï¸ Clicked input type=text id=toStationText aria-label=è¯·è¾“å…¥æˆ–é€‰æ‹©åˆ°è¾¾åœ°ï¼ŒæŒ‰é”®ç›˜ä¸Šä¸‹é”®è¿›è¡Œé€‰æ‹©
INFO     [Agent]   â–¶ï¸  [2/2] input: index: 3424, text: æ€€æŸ”åŒ—, clear: True
INFO     [BrowserSession] âŒ¨ï¸ Typed "æ€€æŸ”åŒ—" into element with index 3424
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 5:
INFO     [Agent]   ğŸ‘ Eval: Successfully input 'æ€€æŸ”åŒ—' into the arrival station field and triggered the dropdown list. Verdict: Success
INFO     [Agent]   ğŸ§  Memory: The departure station 'åŒ—äº¬åŒ—' has been set, and the arrival station 'æ€€æŸ”åŒ—' has been typed into the input field. The dropdown list now shows 'æ€€æŸ”åŒ—' as an option. Next step is to select it from the dropdown.
INFO     [Agent]   ğŸ¯ Next goal: Click on the 'æ€€æŸ”åŒ—' option in the dropdown list to confirm the selection.
INFO     [Agent]   â–¶ï¸   click: index: 7090
INFO     [tools] ğŸ–±ï¸ Clicked span "æ€€æŸ”åŒ—"
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 6:
INFO     [Agent]   ğŸ‘ Eval: Successfully selected 'æ€€æŸ”åŒ—' from the dropdown list. Verdict: Success
INFO     [Agent]   ğŸ§  Memory: The departure station 'åŒ—äº¬åŒ—' and arrival station 'æ€€æŸ”åŒ—' have been successfully set. The next step is to input the departure date '2025-12-31' into the 'å‡ºå‘æ—¥æœŸ' field.
INFO     [Agent]   ğŸ¯ Next goal: Click on the 'å‡ºå‘æ—¥æœŸ' input field and input '2025-12-31'.
INFO     [Agent]   â–¶ï¸  [1/2] click: index: 3425
INFO     [tools] ğŸ–±ï¸ Clicked input type=text id=train_date aria-label=è¯·è¾“å…¥æ—¥æœŸï¼Œä¾‹å¦‚2021æ 01æ 01
INFO     [Agent]   â–¶ï¸  [2/2] input: index: 3425, text: 2025-12-31, clear: True
INFO     [BrowserSession] âŒ¨ï¸ Typed "2025-12-31" into element with index 3425
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 7:
INFO     [Agent]   ğŸ‘ Eval: Successfully input '2025-12-31' into the departure date field. Verdict: Success
INFO     [Agent]   ğŸ§  Memory: Departure station 'åŒ—äº¬åŒ—', arrival station 'æ€€æŸ”åŒ—', and departure date '2025-12-31' have all been correctly set. The next step is to click the 'æŸ¥è¯¢' (Search) button to retrieve train options.
INFO     [Agent]   ğŸ¯ Next goal: Click the 'æŸ¥è¯¢' button to search for available trains from åŒ—äº¬åŒ— to æ€€æŸ”åŒ— on 2025-12-31.
INFO     [Agent]   â–¶ï¸   click: index: 4492
INFO     [tools] ğŸ–±ï¸ Clicked a "æŸ¥Â Â Â Â è¯¢" id=search_one
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 8:
INFO     [Agent]   ğŸ‘ Eval: Successfully clicked the 'æŸ¥è¯¢' (Search) button. Verdict: Success
INFO     [Agent]   ğŸ§  Memory: Departure station 'åŒ—äº¬åŒ—', arrival station 'æ€€æŸ”åŒ—', and departure date '2025-12-31' have been correctly set. The search has been initiated, and now the train options should be displayed on the page.
INFO     [Agent]   ğŸ¯ Next goal: Wait for the train options to load and locate the S511 train schedule to proceed with booking.
INFO     [Agent]   â–¶ï¸   click: index: 4492
INFO     [tools] ğŸ–±ï¸ Clicked a "æŸ¥Â Â Â Â è¯¢" id=search_one
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 9:
INFO     [Agent]   ğŸ‘ Eval: Successfully clicked the 'æŸ¥è¯¢' (Search) button. Verdict: Success
INFO     [Agent]   ğŸ§  Memory: Departure station 'åŒ—äº¬åŒ—', arrival station 'æ€€æŸ”åŒ—', and departure date '2025-12-31' have been correctly set. The search has been initiated, and now waiting for the train options to load.
INFO     [Agent]   ğŸ¯ Next goal: Wait for the train options to load and locate the S511 train schedule to proceed with booking.
INFO     [Agent]   â–¶ï¸   wait: seconds: 3
INFO     [tools] ğŸ•’ waited for 3 seconds
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 10:
INFO     [Agent]   â” Eval: Waited for 3 seconds to allow the train options to load, but the S511 train schedule is not yet visible. Verdict: Uncertain
INFO     [Agent]   ğŸ§  Memory: Departure station 'åŒ—äº¬åŒ—', arrival station 'æ€€æŸ”åŒ—', and departure date '2025-12-31' have been correctly set. The search has been initiated, but the train options are still loading or not fully displayed.
INFO     [Agent]   ğŸ¯ Next goal: Wait for the train options to fully load and locate the S511 train schedule to proceed with booking.
INFO     [Agent]   â–¶ï¸   wait: seconds: 3
INFO     [tools] ğŸ•’ waited for 3 seconds
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 11:
INFO     [Agent]   â” Eval: Waited for 3 seconds but the train options are still not visible. Verdict: Uncertain
INFO     [Agent]   ğŸ§  Memory: Departure station 'åŒ—äº¬åŒ—', arrival station 'æ€€æŸ”åŒ—', and departure date '2025-12-31' have been correctly set. The search has been initiated, but the train options are still loading or not fully displayed. Need to wait longer for the page to load completely.
INFO     [Agent]   ğŸ¯ Next goal: Wait for an additional 5 seconds to allow the train options to fully load and locate the S511 train schedule.
INFO     [Agent]   â–¶ï¸   wait: seconds: 5
INFO     [tools] ğŸ•’ waited for 5 seconds
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 12:
INFO     [Agent]   â” Eval: Waited for 5 seconds but the train options are still not visible. Verdict: Uncertain
INFO     [Agent]   ğŸ§  Memory: Departure station 'åŒ—äº¬åŒ—', arrival station 'æ€€æŸ”åŒ—', and departure date '2025-12-31' have been correctly set. The search has been initiated, but the train options are still loading or not fully displayed. Need to wait longer for the page to load completely.
INFO     [Agent]   ğŸ¯ Next goal: Wait for an additional 5 seconds to allow the train options to fully load and locate the S511 train schedule.
INFO     [Agent]   â–¶ï¸   wait: seconds: 5
INFO     [tools] ğŸ•’ waited for 5 seconds
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 13:
INFO     [Agent]   â” Eval: Waited for 5 seconds but the train options are still not visible. Verdict: Uncertain
INFO     [Agent]   ğŸ§  Memory: Departure station 'åŒ—äº¬åŒ—', arrival station 'æ€€æŸ”åŒ—', and departure date '2025-12-31' have been correctly set. The search has been initiated, but the train options are still loading or not fully displayed. Need to wait longer for the page to load completely.
INFO     [Agent]   ğŸ¯ Next goal: Wait for an additional 5 seconds to allow the train options to fully load and locate the S511 train schedule.
INFO     [Agent]   â–¶ï¸   wait: seconds: 5
INFO     [tools] ğŸ•’ waited for 5 seconds
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 14:
INFO     [Agent]   â” Eval: Waited for 5 seconds but the train options are still not visible. Verdict: Uncertain
INFO     [Agent]   ğŸ§  Memory: Departure station 'åŒ—äº¬åŒ—', arrival station 'æ€€æŸ”åŒ—', and departure date '2025-12-31' have been correctly set. The search has been initiated, but the train options are still loading or not fully displayed. Need to wait longer for the page to load completely.
INFO     [Agent]   ğŸ¯ Next goal: Wait for an additional 5 seconds to allow the train options to fully load and locate the S511 train schedule.
INFO     [Agent]   â–¶ï¸   wait: seconds: 5
INFO     [tools] ğŸ•’ waited for 5 seconds
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 15:
INFO     [Agent]   â” Eval: Waited for 5 seconds but the train options are still not visible. Verdict: Uncertain
INFO     [Agent]   ğŸ§  Memory: Departure station 'åŒ—äº¬åŒ—', arrival station 'æ€€æŸ”åŒ—', and departure date '2025-12-31' have been correctly set. The search has been initiated, but the train options are still loading or not fully displayed. Need to wait longer for the page to load completely.
INFO     [Agent]   ğŸ¯ Next goal: Wait for an additional 10 seconds to allow the train options to fully load and locate the S511 train schedule.
INFO     [Agent]   â–¶ï¸   wait: seconds: 10
INFO     [tools] ğŸ•’ waited for 10 seconds
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 16:
INFO     [Agent]   â” Eval: Waited for 10 seconds but the train options are still not visible. Verdict: Uncertain
INFO     [Agent]   ğŸ§  Memory: Departure station 'åŒ—äº¬åŒ—', arrival station 'æ€€æŸ”åŒ—', and departure date '2025-12-31' have been correctly set. The search has been initiated, but the train options are still loading or not fully displayed. Need to wait longer for the page to load completely.
INFO     [Agent]   ğŸ¯ Next goal: Wait for an additional 10 seconds to allow the train options to fully load and locate the S511 train schedule.
INFO     [Agent]   â–¶ï¸   wait: seconds: 10
INFO     [tools] ğŸ•’ waited for 10 seconds
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 17:
INFO     [Agent]   â” Eval: Waited for 10 seconds but the train options are still not visible. Verdict: Uncertain
INFO     [Agent]   ğŸ§  Memory: Departure station 'åŒ—äº¬åŒ—', arrival station 'æ€€æŸ”åŒ—', and departure date '2025-12-31' have been correctly set. The search has been initiated, but the train options are still loading or not fully displayed. Need to wait longer for the page to load completely.
INFO     [Agent]   ğŸ¯ Next goal: Wait for an additional 10 seconds to allow the train options to fully load and locate the S511 train schedule.
INFO     [Agent]   â–¶ï¸   wait: seconds: 10
INFO     [tools] ğŸ•’ waited for 10 seconds
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 18:
INFO     [Agent]   â” Eval: Waited for 10 seconds but the train options are still not visible. Verdict: Uncertain
INFO     [Agent]   ğŸ§  Memory: Departure station 'åŒ—äº¬åŒ—', arrival station 'æ€€æŸ”åŒ—', and departure date '2025-12-31' have been correctly set. The search has been initiated, but the train options are still loading or not fully displayed. Need to wait longer for the page to load completely.
INFO     [Agent]   ğŸ¯ Next goal: Wait for an additional 10 seconds to allow the train options to fully load and locate the S511 train schedule.
INFO     [Agent]   â–¶ï¸   wait: seconds: 10
INFO     [tools] ğŸ•’ waited for 10 seconds
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 19:
INFO     [Agent]   â” Eval: Waited for 10 seconds but the train options are still not visible. Verdict: Uncertain
INFO     [Agent]   ğŸ§  Memory: Departure station 'åŒ—äº¬åŒ—', arrival station 'æ€€æŸ”åŒ—', and departure date '2025-12-31' have been correctly set. The search has been initiated, but the train options are still loading or not fully displayed. Need to wait longer for the page to load completely.
INFO     [Agent]   ğŸ¯ Next goal: Wait for an additional 10 seconds to allow the train options to fully load and locate the S511 train schedule.
INFO     [Agent]   â–¶ï¸   wait: seconds: 10
INFO     [tools] ğŸ•’ waited for 10 seconds
^C

â¸ï¸ Paused the agent and left the browser open.
	Press [Enter] to resume or [Ctrl+C] again to quit.
----------------------------------------------------------------------
WARNING  [BrowserSession] [SessionManager] Agent focus target 07D166F4... detached! Current focus: None (already cleared). Auto-recovering by switching to another target...
WARNING  [BrowserSession] [SessionManager] No tabs remain! Creating new tab for agent...
WARNING  [BrowserSession] Cannot navigate - browser not connected
ERROR    [BrowserSession] [SessionManager] âŒ Error during agent_focus recovery: RuntimeError: {'code': -32000, 'message': 'Failed to open new tab - no browser is open'}
^C

ğŸ›‘  Got second Ctrl+C. Exiting immediately...

(tip: press [Enter] once to fix escape codes appearing after chrome exit)
(browser_use_py312) zhbli@zhbli-91C6A09QKX:~/projects/20251216GUIAgent/code/browser_use_example$ 

# ç»“æœåˆ†æ

åœ¨è¾“å…¥æ—¥æœŸé‚£ä¸€æ­¥å¤±è´¥ã€‚

INFO     [Agent] ğŸ“ Step 6:
INFO     [Agent]   ğŸ‘ Eval: Successfully selected 'æ€€æŸ”åŒ—' from the dropdown list. Verdict: Success
INFO     [Agent]   ğŸ§  Memory: The departure station 'åŒ—äº¬åŒ—' and arrival station 'æ€€æŸ”åŒ—' have been successfully set. The next step is to input the departure date '2025-12-31' into the 'å‡ºå‘æ—¥æœŸ' field.
INFO     [Agent]   ğŸ¯ Next goal: Click on the 'å‡ºå‘æ—¥æœŸ' input field and input '2025-12-31'.
INFO     [Agent]   â–¶ï¸  [1/2] click: index: 3425
INFO     [tools] ğŸ–±ï¸ Clicked input type=text id=train_date aria-label=è¯·è¾“å…¥æ—¥æœŸï¼Œä¾‹å¦‚2021æ 01æ 01
INFO     [Agent]   â–¶ï¸  [2/2] input: index: 3425, text: 2025-12-31, clear: True
INFO     [BrowserSession] âŒ¨ï¸ Typed "2025-12-31" into element with index 3425
INFO     [Agent] 

å¯¹åº”çš„htmlä¸ºï¼š
```html
<div class="input-box input-data">
    <input type="text" class="input inp-txt_select" id="train_date" aria-label="è¯·è¾“å…¥æ—¥æœŸï¼Œä¾‹å¦‚2021æ 01æ 01" autocomplete="off">
    <i class="icon icon-date" data-click="train_date"></i>
</div>
```

ä¸çŸ¥é“ä¸ºä»€ä¹ˆå¤±æ•ˆã€‚å¯æ˜¯ï¼Œéæ™ºèƒ½ä½“çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–éš¾é“ä¸èƒ½å¡«å†™ä¹ˆï¼Ÿéš¾é“ä¸æ˜¯åšè¿™äº‹çš„æœ€æ­£ç¡®æ–¹æ³•ä¹ˆï¼Ÿ

ä¸è¿‡ï¼Œéæ™ºèƒ½ä½“çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–çš„å‰ææ˜¯å¯¹ç½‘é¡µçš„htmlæœ‰elementçº§åˆ«çš„äº†è§£ã€‚çœ‹æ¥åŸºäºæ™ºèƒ½ä½“çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–è¿˜çœŸçš„æ˜¯æœ‰æ„ä¹‰çš„ã€‚

ä¸è¿‡ï¼ŒåŸºäºæ™ºèƒ½ä½“çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–çš„åº•å±‚æ“ä½œï¼Œè¿˜æ˜¯ä¼ ç»Ÿæµè§ˆå™¨è‡ªåŠ¨åŒ–ã€‚

ä¸ºä»€ä¹ˆåœ¨è¿™ä¸ªä»»åŠ¡ä¸­ï¼Œæ—¥æœŸæ²¡æœ‰å¡«å†™æˆåŠŸå‘¢ï¼Ÿ

æƒ³è¦å¼„æ‡‚è¿™ä¸€ç‚¹ï¼Œå°±å¿…é¡»çŸ¥é“åº•å±‚å…·ä½“è°ƒç”¨äº†å“ªä¸ªå‡½æ•°æ¥æ‰§è¡Œçš„å¡«å†™æ­¥éª¤ã€‚

å¦‚ä½•å¾—çŸ¥å‘¢ï¼Ÿ

é—®è±†åŒ…ï¼Ÿ

python æœ‰æ²¡æœ‰åŠæ³•çŸ¥é“ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä¾æ¬¡è°ƒç”¨äº†å“ªäº›å‡½æ•°ï¼Ÿ
- trace å‡½æ•°ï¼šæ²¡ååº”
- viztracerï¼šæˆåŠŸã€‚ä½†æ˜¯è°ƒç”¨å †æ ˆçš„å¤æ‚ç¨‹åº¦è¶…å‡ºæˆ‘çš„æƒ³è±¡ã€‚

è±†åŒ…è¯´æ˜¯fillå‡½æ•°ã€‚æˆ‘çªç„¶å‘ç°è¿™ä¸ªå‡½æ•°ä¸­æœ‰loggerã€‚æˆ‘è·å–äº†æ—¥å¿—å°±çŸ¥é“åŸå› äº†ã€‚

å¦‚ä½•è·å–æ—¥å¿—ï¼Ÿ

é—®è±†åŒ…ã€‚

è±†åŒ…æä¾›çš„æ–¹æ³•æ— æ•ˆã€‚

çœ‹çœ‹ from browser_use.logging_config import setup_logging  # å¯¼å…¥æ—¥å¿—é…ç½®å·¥å…·

ç¡®å®èƒ½å¤Ÿå†™å…¥æ–‡ä»¶ã€‚ä½†æ˜¯äº‹å®ä¸Šä¹Ÿç¡®å®æ²¡æœ‰çœ‹åˆ°logæ–‡ä»¶ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿdebugï¼Ÿè¿™æ ·çš„è¯ï¼Œèƒ½å¤Ÿç›´æ¥çœ‹åˆ°è°ƒç”¨çš„æ˜¯å“ªä¸ªç‚¹å‡»å‡½æ•°ã€‚

æˆ‘éœ€è¦æ–°å»ºä¸€ä¸ªcondaç¯å¢ƒï¼Œä»æºä»£ç å®‰è£…ã€‚

æˆ‘çªç„¶æƒ³åˆ°ï¼Œè¾“å…¥ç¡®å®æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ä¸€æ¬¡æ€§è¾“å…¥ï¼Œå¦ä¸€ç§æ˜¯é€å­—è¾“å…¥ã€‚æˆ‘è¯•è¯•é€å­—è¾“å…¥è¡Œä¸è¡Œã€‚è¯´ä¸å®šæ˜¯ç½‘é¡µä¸å…è®¸ä¸€æ¬¡æ€§è¾“å…¥è¿™ç§æ˜æ˜¾çš„æœºå™¨äººæ“ä½œå‘¢ï¼Ÿ

ä½†æ˜¯è¿™ç§æ¨æµ‹æ˜¯è¦æœ‰ä¾æ®çš„ã€‚ç½‘é¡µæ˜¯å¦çœŸçš„å­˜åœ¨è¿™ç§æœºåˆ¶â€”â€”å…è®¸é€å­—è¾“å…¥ä½†ä¸å…è®¸ä¸€æ¬¡æ€§è¾“å…¥è¿™ç§æ˜æ˜¾çš„æœºå™¨äººæ“ä½œå‘¢ï¼Ÿæ€ä¹ˆåˆ¤æ–­å‘¢ï¼Ÿ

é—® geminiï¼š

```
ç½‘é¡µæ˜¯å¦å­˜åœ¨è¿™ç§æœºåˆ¶â€”â€”å…è®¸é€å­—è¾“å…¥ä½†ä¸å…è®¸ä¸€æ¬¡æ€§è¾“å…¥è¿™ç§æ˜æ˜¾çš„æœºå™¨äººæ“ä½œå‘¢ï¼Ÿ
```

æœ‰ã€‚

è¿½é—®geminiï¼š

```
å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç½‘é¡µæ˜¯å¦çœŸçš„å­˜åœ¨æ­¤ç±»æœºåˆ¶ï¼Ÿ
```

æˆ‘è¯•äº†ä¸€ä¸‹æ‰‹åŠ¨ç²˜è´´ï¼Œå‘å±•å¯ä»¥ã€‚è¯´æ˜è¿™ç§çŒœæµ‹æ˜¯é”™è¯¯çš„ã€‚

æ‰€ä»¥ï¼Œè¿˜å¾—æ˜¯çœ‹æºä»£ç ï¼Œçœ‹çœ‹ç©¶ç«Ÿä¸ºä»€ä¹ˆæ²¡æœ‰è¾“å…¥æˆåŠŸã€‚

æ–°å»ºcondaç¯å¢ƒ

```
conda create -n browser_use_source_py312 python=3.12
```

å®‰è£…ä»£ç 

```
cd /home/zhbli/projects/browser-use
pip install -e .
```

åœ¨pycharmä¸­æ‰“å¼€ã€‚åŠ æ–­ç‚¹ã€‚æœªèƒ½å‘½ä¸­ã€‚ä¸¤ç§å¯èƒ½ï¼š
- æ ¹æœ¬æ²¡æœ‰å‘½ä¸­ä»»ä½•æ–­ç‚¹çš„èƒ½åŠ›
- æˆ‘åŠ çš„æ–­ç‚¹ä½ç½®ä¸å¯¹

åœ¨è‚¯å®šèƒ½èµ°åˆ°çš„ä½ç½®åŠ æ–­ç‚¹ã€‚è¿˜æ˜¯æ²¡å‘½ä¸­ã€‚

åœ¨æ›´åŸºæœ¬çš„ä½ç½®åŠ æ–­ç‚¹ã€‚å‘½ä¸­äº†ã€‚æ ¸å¿ƒä»£ç å†…éƒ¨ã€‚æ‰€ä»¥æ˜¯æˆ‘çš„æ–­ç‚¹ä½ç½®ä¸å¯¹ã€‚æ‰€ä»¥æˆ‘éœ€è¦æ‰¾åˆ°å…·ä½“æ‰§è¡Œåˆ°äº†ä»€ä¹ˆåœ°æ–¹ã€‚

å…¶å®æˆ‘å¯ä»¥å€Ÿæ­¤æœºä¼šå¼„æ‡‚ä»£ç åŸç†ï¼š

```
agent = Agent()
agent.run()
```

```browser_use/agent/service.py
class Agent:
    def run():
        while self.state.n_steps <= max_steps:
            self._execute_step()
```

```browser_use/agent/service.py
class Agent:
    def _execute_step():
        self.step()
```

```browser_use/agent/service.py
class Agent:
    def step():
        self._execute_actions()
```

```browser_use/agent/service.py
class Agent:
    def _execute_actions():
        self.multi_act()
```

```browser_use/agent/service.py
class Agent:
    def multi_act():
        for i, action in enumerate(actions):
            self.tools.act(action)
```

```
# browser_use/tools/registry/service.py
class Registry:
    def execute_action():
        action = self.registry.actions[action_name]  # å…³äºè¾“å…¥æ–‡æœ¬çš„åŠ¨ä½œï¼Œåªæœ‰ input è¿™ä¸€ç§ã€‚æ²¡æœ‰æ‰€è°“çš„è¿è´¯è¾“å…¥ã€é€å­—è¾“å…¥ä¹‹åˆ†ã€‚
        action.function()  # çœŸæ­£æ‰§è¡Œä¸€æ­¥åŠ¨ä½œã€‚è¾“å…¥æ–‡æœ¬ï¼šè°ƒç”¨Tools.input()å‡½æ•°
```

```
# browser_use/tools/service.py
class Tools:
    def __init__():
        @self.registry.action(
			'Input text into element by index.',
			param_model=InputTextAction,
		)

        # å®é™…æµç¨‹ä¸­ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ
        def input(params: InputTextAction):
            event = browser_session.event_bus.dispatch(  # è°ƒç”¨ DefaultActionWatchdog._input_text_element_node_impl()å‡½æ•°
                TypeTextEvent(
                    node=node,
                    text=params.text,
                    clear=params.clear,
                    is_sensitive=has_sensitive_data,
                    sensitive_key_name=sensitive_key_name,
                )
            )

    def act(action):
        self.registry.execute_action()
```

```
# browser_use/browser/watchdogs/default_action_watchdog.py
class DefaultActionWatchdog:
    def _input_text_element_node_impl():  # æ³¨æ„ï¼Œå¤–éƒ¨æœ‰åˆ¤æ–­è¶…æ—¶æœºåˆ¶ã€‚å¦‚æœè¶…æ—¶ï¼Œåˆ™è¯¥å‡½æ•°æ— æ³•èµ°å®Œå®Œæ•´æµç¨‹ã€‚
        for i, char in enumerate(text): # æ‰§è¡Œå…·ä½“çš„è¾“å…¥æ–‡æœ¬çš„åŠ¨ä½œã€‚
            ...
```

```
# browser_use/browser/watchdog_base.py
class BaseWatchdog:
    def attach_handler_to_session():
        def make_unique_handler():
            def unique_handler():
                actual_handler()  # æ‰§è¡Œå…·ä½“çš„è¾“å…¥æœ¬æ–‡çš„åŠ¨ä½œã€‚è°ƒç”¨ on_TypeTextEvent
```

```
# browser_use/browser/watchdogs/default_action_watchdog.py
class DefaultActionWatchdog:
    def on_TypeTextEvent():
        self._input_text_element_node_impl() # æ‰§è¡Œå…·ä½“çš„è¾“å…¥æ–‡æœ¬çš„åŠ¨ä½œ
```

å‘ç°é—®é¢˜äº†ã€‚æ²¡æœ‰çœŸæ­£è§¦å‘åˆ°å¯¹è¯æ¡†ã€‚å› ä¸ºå¦‚æœçœŸæ­£è§¦å‘åˆ°å¯¹è¯æ¡†ï¼Œå¯¹è¯æ¡†åº”è¯¥æ˜¯è“è‰²è€Œä¸”æœ‰å…‰æ ‡é—ªåŠ¨ï¼Œä½†äº‹å®ä¸Šè¿™äº›ç‰¹å¾éƒ½æ²¡æœ‰ï¼Œå¯¼è‡´è¾“å…¥ä¸è¿›å»ã€‚

æˆ‘å‘ç°æˆ‘åœ¨æç¤ºè¯é‡Œå†™çš„æ˜¯ ç‚¹å‡» å‡ºå‘æ—¥æœŸ åˆ—è¡¨ è¾“å…¥ xxxï¼Œè¿™ä¸å¯¹ã€‚åº”è¯¥æ˜¯ç‚¹å‡» å‡ºå‘æ—¥æœŸæ–‡æœ¬æ¡†ã€‚å°±æ˜¯è¯´ï¼Œç¼ºå°‘äº†â€œç‚¹ä¸€ä¸‹â€çš„åŠ¨ä½œã€‚

æˆ‘æƒ³æŸ¥çœ‹å…·ä½“éƒ½æ‰§è¡Œäº†å“ªäº›åŠ¨ä½œã€‚æŒ‰ç†è¯´æ—¥å¿—ä¿å­˜äº†ï¼Œä½†æ²¡çœ‹åˆ°ã€‚æˆ‘åº”è¯¥debugä¸€ä¸‹æ—¥å¿—ä¿å­˜ç›¸å…³ä»£ç ã€‚

é€šè¿‡é˜…è¯»ä»£ç å¯çŸ¥ï¼Œåº”è¯¥ä»é…ç½®æ–‡ä»¶ä¸­è®¾ç½®æ—¥å¿—ä¿å­˜è·¯å¾„ã€‚
- è¯•è¯•è®¾ç½®ç¯å¢ƒå˜é‡æ˜¯å¦æœ‰æ•ˆ

è±†åŒ…å‘Šè¯‰æˆ‘æœ€å¥½é€šè¿‡.envæ–‡ä»¶æ§åˆ¶ã€‚æˆåŠŸã€‚

æˆ‘å›é¡¾è§†é¢‘ï¼Œå‘ç°æ—¥æœŸæ–‡æœ¬æ¡†æœ‰ä¸€ç¬é—´æ˜¯è·å–äº†ç„¦ç‚¹çš„ï¼Œä½†æ˜¯éšåç«‹å³å¤±å»äº†ç„¦ç‚¹ã€‚

æˆ‘éœ€è¦é‡å¤æµ‹è¯•ï¼š
- åœ¨12306.cn çš„ å‡ºå‘åœ°æ–‡æœ¬æ¡†ï¼šæ¸…é™¤ç°æœ‰å†…å®¹å è¾“å…¥ åŒ—äº¬åŒ—ã€‚éšå³ç»“æŸä»»åŠ¡ã€‚
 - æˆåŠŸã€‚
- åœ¨12306.cn çš„ å‡ºå‘æ—¥æœŸæ–‡æœ¬æ¡†ï¼šæ¸…é™¤ç°æœ‰å†…å®¹åè¾“å…¥ 2025-12-31ã€‚éšå³ç»“æŸä»»åŠ¡ã€‚

æˆåŠŸã€‚ä¸ºä»€ä¹ˆï¼Ÿè¿™æ¬¡æˆåŠŸä»¥å‰ä¸æˆåŠŸï¼Ÿæˆ‘éœ€è¦æ¢å¤ä»¥å‰ä¸æˆåŠŸçš„æƒ…å†µã€‚
- å·²ç»å¤ç°ã€‚ä¸”ä¿å­˜æ—¥å¿—ã€‚

ä¿å­˜æˆåŠŸæ—¥å¿—ï¼šå®Œæˆã€‚

å¯¹æ¯”ä¸¤ä¸ªæ—¥å¿—ä¸­å¯¹æ—¥æœŸæ“ä½œçš„å·®å¼‚ã€‚

geminiè¯´ï¼ŒæˆåŠŸçš„é‚£æ¬¡æ²¡æœ‰è§¦å‘æ—¥æœŸé€‰æ‹©å™¨ï¼Œå¯¼è‡´æ²¡æœ‰å¤±å»ç„¦ç‚¹ã€‚æˆ‘éœ€è¦è¿›ä¸€æ­¥ç¡®è®¤ã€‚äº‹å®ç¡®å®å¦‚æ­¤ã€‚

INFO     [Agent] ğŸ“ Step 2:
INFO     [Agent]   ğŸ‘ Eval: The navigation to the 12306 homepage was successful, and the departure date input field is now visible and ready for interaction.
INFO     [Agent]   ğŸ§  Memory: The 12306 homepage has been successfully loaded. The departure date input field (id=train_date) is identified and ready for input. The next step is to clear its content and enter '2025-12-31'.
INFO     [Agent]   ğŸ¯ Next goal: Clear the existing content in the departure date text box and input '2025-12-31'.
INFO     [Agent]   â–¶ï¸   input: index: 3416, text: 2025-12-31, clear: True
INFO     [BrowserSession] âŒ¨ï¸ Typed "2025-12-31" into element with index 3416
INFO     [Agent] 

å¤±è´¥çš„é‚£æ¬¡ï¼š
INFO     [Agent] ğŸ“ Step 6:
INFO     [Agent]   ğŸ‘ Eval: Successfully selected 'æ€€æŸ”åŒ—' from the dropdown list. Verdict: Success
INFO     [Agent]   ğŸ§  Memory: The departure station 'åŒ—äº¬åŒ—' and arrival station 'æ€€æŸ”åŒ—' have been successfully set. The next step is to input the departure date '2025-12-31' into the 'å‡ºå‘æ—¥æœŸ' field.
INFO     [Agent]   ğŸ¯ Next goal: Click on the 'å‡ºå‘æ—¥æœŸ' input field and input '2025-12-31'.
INFO     [Agent]   â–¶ï¸  [1/2] click: index: 3425
INFO     [tools] ğŸ–±ï¸ Clicked input type=text id=train_date aria-label=è¯·è¾“å…¥æ—¥æœŸï¼Œä¾‹å¦‚2021æ 01æ 01
INFO     [Agent]   â–¶ï¸  [2/2] input: index: 3425, text: 2025-12-31, clear: True
INFO     [BrowserSession] âŒ¨ï¸ Typed "2025-12-31" into element with index 3425
INFO     [Agent] 


## å¤ç°é”™è¯¯

é—®é¢˜çš„å…³é”®æ˜¯æˆ‘å¦‚ä½•å¤ç°é”™è¯¯ï¼Ÿ
- æç¤ºè¯ç®€å•ä½†é”™è¯¯ï¼š

```
åœ¨12306.cn ç‚¹å‡» å‡ºå‘æ—¥æœŸ åˆ—è¡¨ï¼Œè¾“å…¥ 2025-12-31
```

æˆåŠŸå¤ç°é”™è¯¯ï¼š

/home/zhbli/miniconda3/envs/browser_use_source_py312/bin/python /home/zhbli/projects/browser-use/examples/zhbli/my_browser_use.py 
INFO     [utils] Copied profile (Default) and Local State to temp directory: /tmp/browser-use-user-data-dir-2cfh7qp3
INFO     [service] Using anonymized telemetry, see https://docs.browser-use.com/development/telemetry.
INFO     [Agent] ğŸ”— Found URL in task: https://12306.cn, adding as initial action...
INFO     [Agent] ğŸ¯ Task: 
        åœ¨12306.cn ç‚¹å‡» å‡ºå‘æ—¥æœŸ åˆ—è¡¨ï¼Œè¾“å…¥ 2025-12-31
        
INFO     [Agent] Starting a browser-use agent with version 0.11.2, with provider=openai and model=qwen-vl-max
INFO     [Agent]   â–¶ï¸   navigate: url: https://12306.cn, new_tab: False
WARNING  [BrowserSession] âš ï¸ Page readiness timeout (4.0s, 5126ms) for https://12306.cn
INFO     [tools] ğŸ”— Navigated to https://12306.cn
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 1:
INFO     [Agent]   ğŸ‘ Eval: Successfully navigated to the 12306.cn homepage. Verdict: Success
INFO     [Agent]   ğŸ§  Memory: Visited the 12306.cn homepage and identified the 'å‡ºå‘æ—¥æœŸ' (departure date) input field with index [10]. The next step is to interact with this field.
INFO     [Agent]   ğŸ¯ Next goal: Click on the 'å‡ºå‘æ—¥æœŸ' input field to activate it for entering the date.
INFO     [Agent]   â–¶ï¸   click: index: 10
INFO     [tools] ğŸ–±ï¸ Clicked input type=text id=train_date aria-label=è¯·è¾“å…¥æ—¥æœŸï¼Œä¾‹å¦‚2021æ 01æ 01
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 2:
INFO     [Agent]   ğŸ‘ Eval: Successfully clicked on the 'å‡ºå‘æ—¥æœŸ' input field, and now it is ready for text input. Verdict: Success
INFO     [Agent]   ğŸ§  Memory: The 'å‡ºå‘æ—¥æœŸ' input field has been activated. The next step is to input the date '2025-12-31' into this field.
INFO     [Agent]   ğŸ¯ Next goal: Input the date '2025-12-31' into the 'å‡ºå‘æ—¥æœŸ' field.
INFO     [Agent]   â–¶ï¸   input: index: 10, text: 2025-12-31, clear: True
INFO     [BrowserSession] âŒ¨ï¸ Typed "2025-12-31" into element with index 10
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 3:
INFO     [Agent]   ğŸ‘ Eval: Successfully input the date '2025-12-31' into the 'å‡ºå‘æ—¥æœŸ' field. Verdict: Success
INFO     [Agent]   ğŸ§  Memory: The date '2025-12-31' has been successfully entered into the 'å‡ºå‘æ—¥æœŸ' input field on the 12306.cn homepage. The next step is to confirm or proceed with any additional actions required by the user request.
INFO     [Agent]   ğŸ¯ Next goal: Click on the 'å‡ºå‘æ—¥æœŸ' input field again to ensure it is properly activated and ready for further interaction if needed.
INFO     [Agent]   â–¶ï¸   click: index: 10
INFO     [tools] ğŸ–±ï¸ Clicked input type=text id=train_date aria-label=è¯·è¾“å…¥æ—¥æœŸï¼Œä¾‹å¦‚2021æ 01æ 01
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 4:
INFO     [Agent]   ğŸ‘ Eval: The previous action of clicking the 'å‡ºå‘æ—¥æœŸ' input field was successful, and the date '2025-12-31' has been entered. Verdict: Success
INFO     [Agent]   ğŸ§  Memory: The 'å‡ºå‘æ—¥æœŸ' input field has been successfully activated and the date '2025-12-31' has been entered. The next step is to confirm or proceed with any additional actions required by the user request.
INFO     [Agent]   ğŸ¯ Next goal: Confirm that the date '2025-12-31' is correctly displayed in the 'å‡ºå‘æ—¥æœŸ' field and proceed with any further instructions if needed.
INFO     [Agent]   â–¶ï¸  [1/2] click: index: 10
INFO     [tools] ğŸ–±ï¸ Clicked input type=text id=train_date aria-label=è¯·è¾“å…¥æ—¥æœŸï¼Œä¾‹å¦‚2021æ 01æ 01
INFO     [Agent]   â–¶ï¸  [2/2] input: index: 10, text: 2025-12-31, clear: True
INFO     [BrowserSession] âŒ¨ï¸ Typed "2025-12-31" into element with index 10
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 5:
INFO     [Agent]   ğŸ‘ Eval: The date '2025-12-31' was successfully entered into the 'å‡ºå‘æ—¥æœŸ' field. Verdict: Success
INFO     [Agent]   ğŸ§  Memory: The 'å‡ºå‘æ—¥æœŸ' input field has been activated and the date '2025-12-31' has been correctly entered. The user request to input this date has been fulfilled.
INFO     [Agent]   ğŸ¯ Next goal: Confirm that the date '2025-12-31' is displayed correctly in the 'å‡ºå‘æ—¥æœŸ' field and proceed to finalize the task.
INFO     [Agent]   â–¶ï¸  [1/2] click: index: 10
INFO     [tools] ğŸ–±ï¸ Clicked input type=text id=train_date aria-label=è¯·è¾“å…¥æ—¥æœŸï¼Œä¾‹å¦‚2021æ 01æ 01
INFO     [Agent]   â–¶ï¸  [2/2] input: index: 10, text: 2025-12-31, clear: True
INFO     [BrowserSession] âŒ¨ï¸ Typed "2025-12-31" into element with index 10
INFO     [Agent] 

INFO     [Agent] ğŸ“ Step 6:
INFO     [Agent]   ğŸ‘ Eval: The date '2025-12-31' was successfully entered into the 'å‡ºå‘æ—¥æœŸ' field. Verdict: Success
INFO     [Agent]   ğŸ§  Memory: The 'å‡ºå‘æ—¥æœŸ' input field has been activated and the date '2025-12-31' has been correctly entered. The user request to input this date has been fulfilled.
INFO     [Agent]   ğŸ¯ Next goal: Confirm that the date '2025-12-31' is displayed correctly in the 'å‡ºå‘æ—¥æœŸ' field and proceed to finalize the task.
INFO     [Agent]   â–¶ï¸  [1/2] click: index: 10
INFO     [tools] ğŸ–±ï¸ Clicked input type=text id=train_date aria-label=è¯·è¾“å…¥æ—¥æœŸï¼Œä¾‹å¦‚2021æ 01æ 01
INFO     [Agent]   â–¶ï¸  [2/2] input: index: 10, text: 2025-12-31, clear: True
INFO     [BrowserSession] âŒ¨ï¸ Typed "2025-12-31" into element with index 10
INFO     [Agent] 

https://developer.volcengine.com/articles/7541273599731040319

è¿™æ˜¯åº•å±‚çš„cdp_use çš„åŸç†ã€‚