# 实验背景

我已经完成了技术路线。我需要思考下一步做什么。根本是要把 Browser Use Agent 做成。

# 实验目的

明确下一步工作内容

# 实验步骤

## 新版 BrowserOS

BrowserOS 已经更新，但是采用了新的调试方式。我试图运行但是出错。我要先看看目前更新到什么程度了。

最近几乎每天都更新。

### 再试一次

通过命令以及文件路径可以看出，很明显是在ubuntu上操作的。

之前不是碰到过问题吗？要不要先回顾一下？实验41没有记录报错日志。我再重新弄一遍吧。注意详细记录错误。

如下是配置文件。注意BROWSEROS_BINARY。这意味着我需要：
- [x] 安装browseros
- [x] 修改路径
```
# Ports (passed to BrowserOS via CLI args)
BROWSEROS_CDP_PORT=9000
BROWSEROS_SERVER_PORT=9100
BROWSEROS_EXTENSION_PORT=9300
VITE_BROWSEROS_SERVER_PORT=9100   # Must match SERVER_PORT

# BrowserOS launch config
BROWSEROS_BINARY=/Applications/BrowserOS.app/Contents/MacOS/BrowserOS
USE_BROWSEROS_BINARY=true
BROWSEROS_DISABLE_SERVER=true
BROWSEROS_USER_DATA_DIR=/tmp/browseros-dev

# Telemetry (browser bundle)
VITE_PUBLIC_POSTHOG_KEY=
VITE_PUBLIC_POSTHOG_HOST=
VITE_PUBLIC_SENTRY_DSN=

# Sentry build (source maps)
SENTRY_AUTH_TOKEN=
SENTRY_ORG=
SENTRY_PROJECT=

NODE_ENV=development
```

如何安装 browseros？已经安装了。安装在哪里了？/usr/bin/browseros

接下来：
```bash
bun run start:server          # Start the server
```

报错：
```bash
$ bun run --filter @browseros/server start
@browseros/server start $ bun --env-file=.env.development src/index.ts
│ Failed to start server: error: Cannot find package 'zod' from '/home/zhbli/下@browseros/server start $ bun --env-file=.env.development src/index.ts
│ Failed to start server: error: Cannot find package 'zod' from '/home/zhbli/下载/BrowserOS-agent-main-47b9c18/BrowserOS-agent-main/packages/shared/src/schemas/llm.ts'
└─ Exited with code 1
error: script "start:server" exited with code 1
```

尝试解决：
```bash
bun add zod --cwd packages/shared
```

成功。

接下来：

```bash
bun run start:agent           # Start agent extension (dev mode)
```

报错：
```bash
$ bun run --filter agent dev
agent dev $ bun --env-file=.env.development wxt
agent dev $ bun --env-file=.env.development wxt
│ [251 lines elided]
│     at wrappedFn (node:internal/errors:543:14)
agent dev $ bun --env-file=.env.development wxt
│ [252 lines elided]
│     at checkExecSyncError (node:child_process:925:11)
agent dev $ bun --env-file=.env.development wxt
│ [252 lines elided]
│     at checkExecSyncError (node:child_process:925:11)
│     at execSync (node:child_process:997:15)
│     at ensureControllerExtBuilt (web-ext.config.ts:22:5)
│     at async web-ext.config.ts:46:5
│     at async Function.import (/home/zhbli/下载/BrowserOS-agent-main-47b9c18/BrowserOS-agent-main/node_modules/.bun/jiti@2.6.1/node_modules/jiti/dist/jiti.cjs:1:158301)
│     at async resolveConfig (/home/zhbli/%E4%B8%8B%E8%BD%BD/BrowserOS-agent-main-47b9c18/BrowserOS-agent-main/node_modules/.bun/c12@3.3.3+99b04d5019f9dd0d/node_modules/c12/dist/index.mjs:320:20)
│     at async loadConfig (/home/zhbli/%E4%B8%8B%E8%BD%BD/BrowserOS-agent-main-47b9c18/BrowserOS-agent-main/node_modules/.bun/c12@3.3.3+99b04d5019f9dd0d/node_modules/c12/dist/index.mjs:149:22)
│     at async resolveConfig (/home/zhbli/%E4%B8%8B%E8%BD%BD/BrowserOS-agent-main-47b9c18/BrowserOS-agent-main/node_modules/.bun/wxt@0.20.13+11d24a72e14c19ac/node_modules/wxt/dist/core/resolve-config.mjs:74:24)
│ 
│ error: "wxt" exited with code 1
└─ Exited with code 1
error: script "start:agent" exited with code 1
```

尝试
```bash
bun run build:ext
```

报错：
```bash
$ bun run --filter browseros-controller build
browseros-controller build $ webpack --mode production
│ [230 lines elided]
│ ./src/websocket/WebSocketClient.ts 9:23-39
│ [tsl] ERROR in /home/zhbli/下载/BrowserOS-agent-main-47b9c18/BrowserOS-agent-main/apps/controller-ext/src/websocket/WebSocketClient.ts(9,24)
│       TS2307: Cannot find module '@/utils/logger' or its corresponding type declarations.
│  @ ./src/background/BrowserOSController.ts 42:0-62 56:28-43
│  @ ./src/background/index.ts 9:0-60 48:39-58
│ 
│ 38 errors have detailed information that is not shown.
│ Use 'stats.errorDetails: true' resp. '--stats-error-details' to show it.
│ 
│ webpack 5.102.1 compiled with 38 errors in 6464 ms
└─ Exited with code 1
error: script "build:ext" exited with code 1
```

尝试：
```bash
cp apps/controller-ext/src/utils/Logger.ts apps/controller-ext/src/utils/logger.ts
```

成功。

接下来：
```bash
(base) zhbli@zhbli-91C6A09QKX:~/下载/BrowserOS-agent-main-47b9c18/BrowserOS-agent-main$ bun run --filter agent dev
agent dev $ bun --env-file=.env.development wxt
│ [89 lines elided]
│     '--browseros-cdp-port=9000',
│     '--browseros-mcp-port=9100',
│     '--browseros-extension-port=9300',
│     '--user-data-dir=/tmp/browseros-dev',
│     'about:blank'
│   ]
│ }
│ 
│ Node.js v25.2.1
│ error: "wxt" exited with code 1
└─ Exited with code 1
```

尝试：
```bash
cd apps/agent
bun --env-file=.env.development wxt
```

结果：
```bash
WXT 0.20.13                                                                                                                                                                   15:18:39
[sentry-vite-plugin] Info: Sending telemetry data on issues and performance to Sentry. To disable telemetry, set `options.telemetry` to `false`.
✔ Started dev server @ http://localhost:3000                                                                                                                                 15:18:39
ℹ Pre-rendering chrome-mv3 for development with Vite 7.3.0                                                                                                                   15:18:39
[sentry-vite-plugin] Info: Sending telemetry data on issues and performance to Sentry. To disable telemetry, set `options.telemetry` to `false`.
⠋ Preparing...[sentry-vite-plugin] Info: Sending telemetry data on issues and performance to Sentry. To disable telemetry, set `options.telemetry` to `false`.
⠧ [1/4] background[sentry-vite-plugin] Info: Sending telemetry data on issues and performance to Sentry. To disable telemetry, set `options.telemetry` to `false`.
⠇ [2/4] content[sentry-vite-plugin] Info: Sending telemetry data on issues and performance to Sentry. To disable telemetry, set `options.telemetry` to `false`.
⠏ [3/4] glow[sentry-vite-plugin] Info: Sending telemetry data on issues and performance to Sentry. To disable telemetry, set `options.telemetry` to `false`.
✔ Built extension in 3.833 s                                                                                                                                                 15:18:43
  ├─ dist/chrome-mv3-dev/manifest.json                            2.4 kB   
  ├─ dist/chrome-mv3-dev/newtab.html                              825 B    
  ├─ dist/chrome-mv3-dev/onboarding.html                          834 B    
  ├─ dist/chrome-mv3-dev/options.html                             886 B    
  ├─ dist/chrome-mv3-dev/sidepanel.html                           880 B    
  ├─ dist/chrome-mv3-dev/background.js                            822.02 kB
  ├─ dist/chrome-mv3-dev/background.js.map                        1.72 MB  
  ├─ dist/chrome-mv3-dev/chunks/newtab-D58oFIT2.js                509 B    
  ├─ dist/chrome-mv3-dev/chunks/newtab-D58oFIT2.js.map            111 B    
  ├─ dist/chrome-mv3-dev/chunks/onboarding-D58oFIT2.js            509 B    
  ├─ dist/chrome-mv3-dev/chunks/onboarding-D58oFIT2.js.map        115 B    
  ├─ dist/chrome-mv3-dev/chunks/options-D58oFIT2.js               509 B    
  ├─ dist/chrome-mv3-dev/chunks/options-D58oFIT2.js.map           112 B    
  ├─ dist/chrome-mv3-dev/chunks/reload-html-YVoR3ZfG.js           3.45 kB  
  ├─ dist/chrome-mv3-dev/chunks/reload-html-YVoR3ZfG.js.map       3.76 kB  
  ├─ dist/chrome-mv3-dev/chunks/sidepanel-D58oFIT2.js             509 B    
  ├─ dist/chrome-mv3-dev/chunks/sidepanel-D58oFIT2.js.map         114 B    
  ├─ dist/chrome-mv3-dev/content-scripts/content.js               8.65 kB  
  ├─ dist/chrome-mv3-dev/content-scripts/content.js.map           12.73 kB 
  ├─ dist/chrome-mv3-dev/content-scripts/glow.js                  12.13 kB 
  ├─ dist/chrome-mv3-dev/content-scripts/glow.js.map              18.2 kB  
  ├─ dist/chrome-mv3-dev/geist-mono/GeistMono-Italic[wght].woff2  78.6 kB  
  ├─ dist/chrome-mv3-dev/geist-mono/GeistMono[wght].woff2         70.91 kB 
  ├─ dist/chrome-mv3-dev/geist/Geist-Italic[wght].woff2           72.7 kB  
  ├─ dist/chrome-mv3-dev/geist/Geist[wght].woff2                  69.24 kB 
  ├─ dist/chrome-mv3-dev/icon/128.png                             8.02 kB  
  ├─ dist/chrome-mv3-dev/icon/16.png                              697 B    
  ├─ dist/chrome-mv3-dev/icon/32.png                              1.55 kB  
  ├─ dist/chrome-mv3-dev/icon/48.png                              2.41 kB  
  ├─ dist/chrome-mv3-dev/icon/96.png                              6.98 kB  
  └─ dist/chrome-mv3-dev/wxt.svg                                  1.07 kB  
Σ Total size: 2.92 MB                                                              
node:events:486
      throw er; // Unhandled 'error' event
      ^

Error: spawn /Applications/BrowserOS.app/Contents/MacOS/BrowserOS ENOENT
    at Process.ChildProcess._handle.onexit (node:internal/child_process:285:19)
    at onErrorNT (node:internal/child_process:483:16)
    at processTicksAndRejections (node:internal/process/task_queues:89:21)
Emitted 'error' event on ChildProcess instance at:
    at Process.ChildProcess._handle.onexit (node:internal/child_process:291:12)
    at onErrorNT (node:internal/child_process:483:16)
    at processTicksAndRejections (node:internal/process/task_queues:89:21) {
  errno: -2,
  code: 'ENOENT',
  syscall: 'spawn /Applications/BrowserOS.app/Contents/MacOS/BrowserOS',
  path: '/Applications/BrowserOS.app/Contents/MacOS/BrowserOS',
  spawnargs: [
    '--user-data-dir=/tmp/tmp-web-ext--44409-tZgXXJVferc0',
    '--disable-features=Translate,OptimizationHints,MediaRouter,DialMediaRouteProvider,CalculateNativeWinOcclusion,InterestFeedContentSuggestions,CertificateTransparencyComponentUpdater,AutofillServerCommunication,PrivacySandboxSettings4',
    '--disable-component-extensions-with-background-pages',
    '--disable-background-networking',
    '--disable-client-side-phishing-detection',
    '--disable-sync',
    '--metrics-recording-only',
    '--disable-default-apps',
    '--no-default-browser-check',
    '--no-first-run',
    '--disable-backgrounding-occluded-windows',
    '--disable-renderer-backgrounding',
    '--disable-background-timer-throttling',
    '--disable-ipc-flooding-protection',
    '--password-store=basic',
    '--use-mock-keychain',
    '--force-fieldtrials=*BackgroundTracing/default/',
    '--disable-hang-monitor',
    '--disable-prompt-on-repost',
    '--disable-domain-reliability',
    '--propagate-iph-for-testing',
    '--remote-debugging-pipe',
    '--enable-unsafe-extension-debugging',
    '--unsafely-disable-devtools-self-xss-warnings',
    '--use-mock-keychain',
    '--show-component-extension-options',
    '--disable-browseros-server',
    '--load-extension=/home/zhbli/下载/BrowserOS-agent-main-47b9c18/BrowserOS-agent-main/apps/controller-ext/dist',
    '--browseros-cdp-port=9000',
    '--browseros-mcp-port=9100',
    '--browseros-extension-port=9300',
    '--user-data-dir=/tmp/browseros-dev',
    'about:blank'
  ]
}

Node.js v25.2.1
error: "wxt" exited with code 1
```

尝试：

将项目中所有 /Applications/BrowserOS.app/Contents/MacOS/BrowserOS 替换为 /usr/bin/browseros

报错：
```bash
WXT 0.20.13                                                                                                                                                                   15:23:36
[sentry-vite-plugin] Info: Sending telemetry data on issues and performance to Sentry. To disable telemetry, set `options.telemetry` to `false`.
✔ Started dev server @ http://localhost:3000                                                                                                                                 15:23:37
ℹ Pre-rendering chrome-mv3 for development with Vite 7.3.0                                                                                                                   15:23:37
[sentry-vite-plugin] Info: Sending telemetry data on issues and performance to Sentry. To disable telemetry, set `options.telemetry` to `false`.
⠋ Preparing...[sentry-vite-plugin] Info: Sending telemetry data on issues and performance to Sentry. To disable telemetry, set `options.telemetry` to `false`.
⠴ [1/4] background[sentry-vite-plugin] Info: Sending telemetry data on issues and performance to Sentry. To disable telemetry, set `options.telemetry` to `false`.
⠦ [2/4] content[sentry-vite-plugin] Info: Sending telemetry data on issues and performance to Sentry. To disable telemetry, set `options.telemetry` to `false`.
⠧ [3/4] glow[sentry-vite-plugin] Info: Sending telemetry data on issues and performance to Sentry. To disable telemetry, set `options.telemetry` to `false`.
✔ Built extension in 3.539 s                                                                                                                                                 15:23:41
  ├─ dist/chrome-mv3-dev/manifest.json                            2.4 kB   
  ├─ dist/chrome-mv3-dev/newtab.html                              825 B    
  ├─ dist/chrome-mv3-dev/onboarding.html                          834 B    
  ├─ dist/chrome-mv3-dev/options.html                             886 B    
  ├─ dist/chrome-mv3-dev/sidepanel.html                           880 B    
  ├─ dist/chrome-mv3-dev/background.js                            822.02 kB
  ├─ dist/chrome-mv3-dev/background.js.map                        1.72 MB  
  ├─ dist/chrome-mv3-dev/chunks/newtab-D58oFIT2.js                509 B    
  ├─ dist/chrome-mv3-dev/chunks/newtab-D58oFIT2.js.map            111 B    
  ├─ dist/chrome-mv3-dev/chunks/onboarding-D58oFIT2.js            509 B    
  ├─ dist/chrome-mv3-dev/chunks/onboarding-D58oFIT2.js.map        115 B    
  ├─ dist/chrome-mv3-dev/chunks/options-D58oFIT2.js               509 B    
  ├─ dist/chrome-mv3-dev/chunks/options-D58oFIT2.js.map           112 B    
  ├─ dist/chrome-mv3-dev/chunks/reload-html-YVoR3ZfG.js           3.45 kB  
  ├─ dist/chrome-mv3-dev/chunks/reload-html-YVoR3ZfG.js.map       3.76 kB  
  ├─ dist/chrome-mv3-dev/chunks/sidepanel-D58oFIT2.js             509 B    
  ├─ dist/chrome-mv3-dev/chunks/sidepanel-D58oFIT2.js.map         114 B    
  ├─ dist/chrome-mv3-dev/content-scripts/content.js               8.65 kB  
  ├─ dist/chrome-mv3-dev/content-scripts/content.js.map           12.73 kB 
  ├─ dist/chrome-mv3-dev/content-scripts/glow.js                  12.13 kB 
  ├─ dist/chrome-mv3-dev/content-scripts/glow.js.map              18.2 kB  
  ├─ dist/chrome-mv3-dev/geist-mono/GeistMono-Italic[wght].woff2  78.6 kB  
  ├─ dist/chrome-mv3-dev/geist-mono/GeistMono[wght].woff2         70.91 kB 
  ├─ dist/chrome-mv3-dev/geist/Geist-Italic[wght].woff2           72.7 kB  
  ├─ dist/chrome-mv3-dev/geist/Geist[wght].woff2                  69.24 kB 
  ├─ dist/chrome-mv3-dev/icon/128.png                             8.02 kB  
  ├─ dist/chrome-mv3-dev/icon/16.png                              697 B    
  ├─ dist/chrome-mv3-dev/icon/32.png                              1.55 kB  
  ├─ dist/chrome-mv3-dev/icon/48.png                              2.41 kB  
  ├─ dist/chrome-mv3-dev/icon/96.png                              6.98 kB  
  └─ dist/chrome-mv3-dev/wxt.svg                                  1.07 kB  
Σ Total size: 2.92 MB                                                              
node:events:486
      throw er; // Unhandled 'error' event
      ^

Error: read ECONNRESET
    at Pipe.onStreamRead (node:internal/stream_base_commons:216:20)
Emitted 'error' event on Socket instance at:
    at emitErrorNT (node:internal/streams/destroy:170:8)
    at emitErrorCloseNT (node:internal/streams/destroy:129:3)
    at processTicksAndRejections (node:internal/process/task_queues:89:21) {
  errno: -104,
  code: 'ECONNRESET',
  syscall: 'read'
}

Node.js v25.2.1
error: "wxt" exited with code 1
```

在 `apps/agent/wxt.config.ts` 添加 runner 配置项。

```typescript
// ============================================================
// 新增配置：指定 BrowserOS 路径并禁用沙箱
// ============================================================
runner: {
  chromiumBinary: '/usr/bin/browseros', // 强制使用 BrowserOS
  chromiumArgs: [
    '--no-sandbox',             // 解决 Linux 下崩溃的关键参数
    '--disable-setuid-sandbox', // 配合 no-sandbox
    // 必须保留项目需要的自定义端口参数
    '--browseros-cdp-port=9000',
    '--browseros-mcp-port=9100',
    '--browseros-extension-port=9300',
    // 指定开发数据的临时目录，防止权限冲突
    '--user-data-dir=/tmp/browseros-dev-wxt', 
  ],
},
// ============================================================
```

成功。但是在浏览器中点击插件按钮无法弹出侧边栏。

我不用browseos浏览器，改用 chrome，从 apps/agent/dist/chrome-mv3 手动导入插件，点击插件按钮，同样无法弹出侧边栏。

我需要卸载现在的browseros，重装一遍，直接打开浏览器，看插件能不能用。如果不能用，那就不是单独插件的问题了。如果能用，我导入插件就行了。

```bash
sudo apt purge browseros
sudo dpkg -i BrowserOS_v0.35.0_amd64.deb
```

可以浏览器自带的插件。不过有bug：界面一开始对话就会变空白。

手动载入已经编译好的插件。不行。

总结：老版本browseros自带插件打不开。新版本browseros自带插件变空白。将编译成功的插件导入chrome打不开。代码写死了macos。综合看，很不成熟。

## 新思路

我想到了要做的事情：使用nanobrowser挑战高难度任务：复制百炼 api key。
难在哪？即使是人工操作，大多数人也不知道如何完成。
在这个过程中agent肯定会犯很多错误。如果能够解决错误，成功执行任务，就是很大的收获。此外，还掌握了nanobrowser。它的优点：
不依赖browseros。如果真用browseros的话，到时候给民警装浏览器也是个问题。而且最新版browseros成熟度很低。
在什么操作系统上都能调试。
代码比browseros-agent简单。

# 实验结果

明确下个实验的内容：

使用nanobrowser挑战高难度任务：复制百炼 api key。
难在哪？即使是人工操作，大多数人也不知道如何完成。
在这个过程中agent肯定会犯很多错误。如果能够解决错误，成功执行任务，就是很大的收获。此外，还掌握了nanobrowser。它的优点：
不依赖browseros。如果真用browseros的话，到时候给民警装浏览器也是个问题。而且最新版browseros成熟度很低。
在什么操作系统上都能调试。
代码比browseros-agent简单。

# 未来计划

使用nanobrowser挑战高难度任务：复制百炼 api key。